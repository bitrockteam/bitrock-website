<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started with Prometheus | Bitrock</title>
    <meta name="description" content="In order to successfully develop and apply innovative technology you need to be able to look beyond the horizon, anticipating trends and recognizing the next standards.">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="icon" href="/logotype.png">
  <link rel="manifest" href="/app.webmanifest">
  <meta name="theme-color" content="#2a2a2a">
  <meta name="author" content="Bitrock">
  <meta name="title" property="og:title" content="Bitrock">
  <meta name="og:description" content="In order to successfully develop and apply innovative technology you need to be able to look beyond the horizon, anticipating trends and recognizing the next standards.">
  <meta name="image" property="og:image" content="/social.png">
    
    <link rel="preload" href="/assets/css/0.styles.b17daab2.css" as="style"><link rel="preload" href="/assets/js/app.dc8d5aea.js" as="script"><link rel="preload" href="/assets/js/5.16fe373e.js" as="script"><link rel="preload" href="/assets/js/31.b9130822.js" as="script"><link rel="preload" href="/assets/js/9.91369f7b.js" as="script"><link rel="prefetch" href="/assets/js/10.1eded6dc.js"><link rel="prefetch" href="/assets/js/11.c912d9a0.js"><link rel="prefetch" href="/assets/js/12.09d69e0b.js"><link rel="prefetch" href="/assets/js/13.1e8463b0.js"><link rel="prefetch" href="/assets/js/14.66b2bd83.js"><link rel="prefetch" href="/assets/js/15.d6ff773e.js"><link rel="prefetch" href="/assets/js/16.09c65213.js"><link rel="prefetch" href="/assets/js/17.a453b3da.js"><link rel="prefetch" href="/assets/js/18.95c4d29c.js"><link rel="prefetch" href="/assets/js/19.71b94f5a.js"><link rel="prefetch" href="/assets/js/2.fb815d92.js"><link rel="prefetch" href="/assets/js/20.1735d7b0.js"><link rel="prefetch" href="/assets/js/21.d59e25a1.js"><link rel="prefetch" href="/assets/js/22.c92c7f3f.js"><link rel="prefetch" href="/assets/js/23.2103b8ae.js"><link rel="prefetch" href="/assets/js/24.4cdb4123.js"><link rel="prefetch" href="/assets/js/25.97fab8d0.js"><link rel="prefetch" href="/assets/js/26.2a00d6f4.js"><link rel="prefetch" href="/assets/js/27.6ecd8c56.js"><link rel="prefetch" href="/assets/js/28.23799554.js"><link rel="prefetch" href="/assets/js/29.18ccb1bb.js"><link rel="prefetch" href="/assets/js/3.44cb95ca.js"><link rel="prefetch" href="/assets/js/30.f2c75cc4.js"><link rel="prefetch" href="/assets/js/32.5d91ee5f.js"><link rel="prefetch" href="/assets/js/33.ed578863.js"><link rel="prefetch" href="/assets/js/34.1596f0d3.js"><link rel="prefetch" href="/assets/js/35.9d012647.js"><link rel="prefetch" href="/assets/js/36.3fd291c5.js"><link rel="prefetch" href="/assets/js/37.23cbb63e.js"><link rel="prefetch" href="/assets/js/38.14a62536.js"><link rel="prefetch" href="/assets/js/39.d9628084.js"><link rel="prefetch" href="/assets/js/4.187cc577.js"><link rel="prefetch" href="/assets/js/40.5f43dfc8.js"><link rel="prefetch" href="/assets/js/41.4132983b.js"><link rel="prefetch" href="/assets/js/42.20661f9a.js"><link rel="prefetch" href="/assets/js/43.c0676b88.js"><link rel="prefetch" href="/assets/js/44.d4c9b385.js"><link rel="prefetch" href="/assets/js/6.94a49d88.js"><link rel="prefetch" href="/assets/js/7.f5d1f2d5.js"><link rel="prefetch" href="/assets/js/8.a6fd5871.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b17daab2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="cover"><header class="main active"><div class="wrapper"><div class="logo"><a href="/" aria-label="Bitrock logo" class="router-link-active"><!----></a></div> <nav><ul><li><a href="/discover" aria-label="About" class="text-">About
          </a></li><li><a href="/academy" aria-label="Academy" class="text-">Academy
          </a></li><li><a href="https://www.linkedin.com/company/bitrock-srl/jobs/" rel="noopener" target="_blank" aria-label="Join Us" class="text-">Join Us</a></li><li><a href="/blog" aria-label="Blog" class="router-link-active text-">Blog
          </a></li></ul></nav> <button type="button" aria-label="mobile-menu" class="hamburger hamburger--spin"><span class="hamburger-box"><span class="hamburger-inner"></span></span></button></div></header> <main class="content wrapper"><article class="card"><div class="category">TECHNOLOGY</div> <section><div class="body"><h3>Getting Started with Prometheus</h3> <div class="content__default"><h2 id="what-is-prometheus"><a href="#what-is-prometheus" aria-hidden="true" class="header-anchor">#</a> What is Prometheus?</h2> <p>Prometheus is an open-source systems monitoring and alerting toolkit written in Go. Released by SoundCloud in 2012, it joined Cloud Native Computing Foundation in 2016 and in 2018 became the second graduated project alongside Kubernetes.</p> <p>Based on metrics and not on logs, Prometheus uses its own time series database called TSDB and its own query language (PromQL).</p> <p>The CNCF community loves Prometheus because:</p> <ul><li>it’s easy to configure, deploy, and maintain</li> <li>it’s designed in multiple services, aiming at modularity</li> <li>it’s container ready, “docker run” is enough to have it started</li> <li>it’s orchestrator ready, supporting dynamic configurations</li> <li>it’s an ecosystem: many client libraries and exporters maintained both by Prometheus team and the community</li></ul> <br> <br> <p><img src="/img/download.png" alt=""></p> <br> <ul><li>Prometheus collects data</li> <li>Exporters expose data</li> <li>Applications expose data</li> <li>Grafana displays data</li> <li>Alertmanager dispatches alerts</li></ul> <p>Prometheus is a pull-based monitoring system that scrapes metrics from configured endpoints, stores them efficiently and supports a powerful query language to compose dynamic information from a variety of otherwise unrelated data points.</p> <p>To monitor your services using Prometheus, your services need to expose a Prometheus endpoint. This endpoint is an HTTP interface that exposes a list of metrics and the respective current values. Prometheus has a wide range of service discovery options to find your services and start collecting metrics data. The Prometheus server continuously polls the metrics interface on your services and stores the data. This provides a standardized way for metrics gathering.</p> <p>Prometheus is designed to fetch data in intervals measured in seconds. And while Prometheus 2.x can handle somewhere north of ten millions series over a time window, which is rather generous, some unwise label choices can eat that surprisingly quickly.</p> <p>Every 2 hours Prometheus compacts the data that has been buffered up in memory onto blocks on disk.</p> <p>To reduce disk footprint, TSDB can have a shorter metrics retention period of the metrics or it can be configured to have a disk space limit. The data can be compacted and the WAL compressed as well.</p> <p>The data structure is self-sufficient and can be moved from one instance to another independently given each time series is atomic and uniquely identified by its metric name (1). In recent Prometheus versions, remote storage support has been introduced in order to provide long term storage.</p> <p>Core Prometheus server is a single binary and each Prometheus server is an independent process with its own storage. One of the downsides of this core implementation is the lack of clustering or backfilling “missing” data when a scrape fails.</p> <br> <p><img src="/img/prometheus-exporter-loghi-1.png" alt=""></p> <br> <p>Prometheus is not supposed to only be used with standard exporters (2), you can instrument your own code to capture the metrics that matter to you, business ones for example. Prometheus comes with the support for a wide range of languages (Go, Java or Scala, Python, Ruby, etc). Many upstream libraries are already instrumented by the maintainers, so you will get that for free!</p> <br> <h2 id="what-is-a-metric"><a href="#what-is-a-metric" aria-hidden="true" class="header-anchor">#</a> What is a metric?</h2> <p>A metric is any numeric value that tells you something about how your system is operating. For example:</p> <ul><li>How much memory it is using</li> <li>How long the last operation took</li> <li>How many request were served today</li></ul> <p><img src="/img/schermata-2020-10-12-alle-15-37-50.png" alt=""></p> <p>In Prometheus there are 4 types of metrics: counter, gauge, histogram and summary.</p> <p>A <strong>counter</strong> is a cumulative metric that represents a single monotonically increasing counter whose value can only increase or be reset to zero on restart. For example, you can use a counter to represent the number of requests served, tasks completed, or errors.</p> <p>A <strong>gauge</strong> is a metric that represents a single numerical value that can arbitrarily go up and down. Gauges are typically used for measured values like temperatures or current memory usage, but also &quot;counts&quot; that can go up and down, like the number of concurrent requests.</p> <p>A <strong>histogram</strong> samples observations, for example request durations or response sizes, and counts them in configurable buckets. It also provides a sum of all observed values. A histogram with a base metric name of <basename> exposes multiple time series during a scrape:</basename></p> <ul><li>cumulative counters for the observation buckets, exposed as <basename>_bucket{le=&quot;<upper inclusive="" bound="">&quot;}</upper></basename></li> <li>the total sum of all observed values, exposed as <basename>_sum</basename></li> <li>the count of events that have been observed, exposed as <basename>_count (identical to <basename>_bucket{le=&quot;+Inf&quot;} above)</basename></basename></li></ul> <p>Similar to a histogram, a <strong>summary</strong> samples observations, for example request durations and response sizes. While it also provides a total count of observations and a sum of all observed values, it calculates configurable quantiles over a sliding time window.</p> <p>A summary with a base metric name of <basename> exposes multiple time series during a scrape:</basename></p> <ul><li>streaming φ-quantiles (0 ≤ φ ≤ 1) of observed events, exposed as <basename>{quantile=&quot;&lt;φ&gt;&quot;}</basename></li> <li>the total sum of all observed values, exposed as <basename>_sum</basename></li> <li>the count of events that have been observed, exposed as <basename>_count</basename></li></ul> <p>The essential difference between summaries and histograms is that summaries calculate streaming φ-quantiles on the client side and expose them directly, while histograms expose bucketed observation counts and the calculation of quantiles from the buckets of a histogram happens on the server side using the histogram_quantile() function.</p> <p><a href="https://prometheus.io/docs/concepts/metric_types/" title="https://prometheus.io/docs/concepts/metric_types/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/concepts/metric_types/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://prometheus.io/docs/practices/histograms/" title="https://prometheus.io/docs/practices/histograms/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/practices/histograms/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <br> <h2 id="understanding-metrics"><a href="#understanding-metrics" aria-hidden="true" class="header-anchor">#</a> Understanding metrics</h2> <p>Prometheus metrics have a name and might have any arbitrary number of labels:</p> <p><img src="/img/schermata-2020-10-12-alle-10-00-56.png" alt=""></p> <p>A Metric has metadata (labels) and lots of functions to filter, change, remove those while fetching them from the targets. The name “node_cpu_seconds_total” consist of a prefix for the namespace (node metrics) and suffix for the unit of the value ( Seconds of CPU time in total )</p> <p><a href="https://prometheus.io/docs/practices/naming/" title="https://prometheus.io/docs/practices/naming/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/practices/naming/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>promtool</strong> allows to lint them for consistency and correctness.</p> <p>Examples:</p> <p><img src="/img/schermata-2020-10-12-alle-10-02-13.png" alt=""></p> <br> <h2 id="promql"><a href="#promql" aria-hidden="true" class="header-anchor">#</a> PromQL</h2> <p>Prometheus Query Language (PromQL) supports a wide range of functions for interacting with scraped metrics. Some examples:</p> <ul><li>Filtering by label: <em>http_requests_total{status=~&quot;5..&quot;}</em></li> <li>Calculating rates: <em>rate(http_requests_total[5m])</em></li> <li>Arithmetic ( +, *, /, -, %, ^) and Comparison ( &gt;, &lt;, &gt;=, &lt;=, ==, != ) operations</li> <li>Aggregation and Grouping: <em>sum(rate(node_network_receive_bytes_total[5m])) by (instance)</em></li> <li>Quantile: <em>histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket[5m])) by (le))</em></li> <li>Recording Rule: precompute frequently needed or computationally expensive expressions, in order to make recurring queries much faster to compute</li></ul> <br> <h2 id="alerting"><a href="#alerting" aria-hidden="true" class="header-anchor">#</a> Alerting</h2> <p>Our motto is: if you can graph it, you can alert on it! It’s really easy to set up alerts in Prometheus, it’s just a matter of defining which query to evaluate and which is the range of safe values:</p> <p><img src="/img/schermata-2020-10-12-alle-10-02-22.png" alt=""></p> <p>Prometheus will evaluate the alerting rule regularly and will mark it as firing in case the rule matches. However, Prometheus core component will not take care directly of sending alerts to final users. Alertmanager instead will take care of performing alert related operations.</p> <p>Alertmanager :</p> <ul><li>Receives alerts from Prometheus</li> <li>Groups them</li> <li>Inhibits them, for example in case of false positives</li> <li>Dispatches them to downstream services, such as Slack or PagerDuty and many more</li> <li>Built In HA leveraging gossip protocol</li></ul> <br> <p><img src="/img/schema.png" alt=""></p> <br> <br> <h2 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h2> <ul><li>Official Project Documentation <a href="https://prometheus.io/docs/" title="https://prometheus.io/docs/" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>A blog on monitoring, scale and operational Sanity <a href="https://www.robustperception.io/blog" title="https://www.robustperception.io/blog" target="_blank" rel="noopener noreferrer">https://www.robustperception.io/blog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/prometheus/alertmanager#high-availability" title="https://github.com/prometheus/alertmanager#high-availability" target="_blank" rel="noopener noreferrer">https://github.com/prometheus/alertmanager#high-availability<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <br> <p><strong>Notes</strong></p> <p>(1) <a href="https://github.com/bitnami/kube-prod-runtime/blob/master/docs/migration-guides/prometheus-migration.md" title="https://github.com/bitnami/kube-prod-runtime/blob/master/docs/migration-guides/prometheus-migration.md" target="_blank" rel="noopener noreferrer">https://github.com/bitnami/kube-prod-runtime/blob/master/docs/migration-guides/prometheus-migration.md<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>(2) <a href="https://prometheus.io/docs/instrumenting/exporters" title="https://prometheus.io/docs/instrumenting/exporters" target="_blank" rel="noopener noreferrer">https://prometheus.io/docs/instrumenting/exporters<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://prometheus.io/docs/instrumenting/exporters" title="https://prometheus.io/docs/instrumenting/exporters" target="_blank" rel="noopener noreferrer">https://github.com/prometheus/prometheus/wiki/default-port-allocations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <br> <p><em>Author: Matteo Gazzetta, DevOps Engineer @Bitrock</em></p></div></div></section></article></main> <footer id="corporate" class="corporate"><div class="wrapper"><article><div><h4>Corporate</h4> <p><a href="https://www.linkedin.com/company/bitrock-srl/jobs/" target="_blank" rel="noopener">Careers</a> <br> <a href="https://databiz.it/#philosophy" target="_blank" rel="noopener">Group philosophy</a> <br> <a href="https://www.iubenda.com/privacy-policy/81384922" target="_blank" rel="noopener">Privacy policy</a></p></div> <div><h4>Treviso</h4> <p>
           Office and Operational HQ<br> 
           Viale della Repubblica 156/a<br> 
           31100 Treviso (TV)<br>
           Tel: 0422 1600025<br> <a href="mailto:info@bitrock.it">info@bitrock.it</a></p></div> <div><h4>Milano</h4> <p>
          Operational HQ<br>
          Via Borsieri 41<br> 
          20159 Milano (MI)<br>
          Tel: 0422 1600025<br> <a href="mailto:info@bitrock.it">info@bitrock.it</a></p></div> <div><h4>Lugano</h4> <p>
          BITROCK SAGL,<br>
          Via Giacometti 1<br> 
          6900 Lugano <br> <a href="mailto:info@bitrock.it">info@bitrock.it</a></p></div> <div><h4>Follow us</h4> <p><a href="https://www.linkedin.com/company/bitrock-srl/" target="_blank" rel="noopener">Linkedin</a><br> <a href="https://twitter.com/DATABIZit" target="_blank" rel="noopener">Twitter</a></p></div></article></div></footer> <footer class="credits"><div class="wrapper"><article><p><b>Bitrock</b> ©Copyright <span class="year">2020</span>. All rights reserved. P.IVA 10150530961</p></article></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.dc8d5aea.js" defer></script><script src="/assets/js/5.16fe373e.js" defer></script><script src="/assets/js/31.b9130822.js" defer></script><script src="/assets/js/9.91369f7b.js" defer></script>
  </body>
</html>
